"use strict";(this.webpackChunk_hz_project_x=this.webpackChunk_hz_project_x||[]).push([[30822],{658240:(e,t,i)=>{i.d(t,{E$:()=>c,oU:()=>d});var s=i(258195),r=i(342356),n=i(937472),o=i(132565),a=i(632353);const h="anonymous_user_id";var d,l;!function(e){e.uninitialized="uninitialized",e.anonymous="anonymous",e.authenticated="authenticated",e.expired="expired"}(d||(d={})),function(e){e.imsLoad="ims-load"}(l||(l={}));class c{constructor(e,t,i,c,g,_={allowLoggedOutUser:!1,customSignInEnabled:!1},u=navigator){this._logger=e,this._sessionPersistenceService=t,this._sessionStorageService=i,this._perf=c,this._imsServiceOptions=g,this.features=_,this._navigator=u,this._userState=d.uninitialized,this._tokenListeners=new Set,this._profileListeners=new Set,this._modalSignInDeferred=new n.B,this._modalSUSICallbackAttached=!1,this._locale="en_US",this._customSignInCallback=void 0,this._customSignInDeferred=void 0,this.processServiceWorkerMessage=async e=>{if("AUTHENTICATION_FAILURE"===e.data.msg){if(this.allowLoggedOutUser&&this.isAnonymousUser())return;let e=!1;try{e=await this._adobeIMS.validateToken()}finally{e||await this._signInInternal("token is not valid",{},!0)}}},this._modalSUSICallbackFunc=e=>{const t=this._modalSignInOptions?.redirect_uri,i=e.origin.includes("adobe.com")||e.origin===window.location.origin;e.data?.includes("wasmodal")&&i?(t&&this._reload(`${t}`),this._modalSignInDeferred.resolve()):this._modalSignInDeferred.reject("unable to sign in. Try again later."),window.removeEventListener("message",this._modalSUSICallbackFunc),this._modalSUSICallbackAttached=!1},this._onAccessToken=e=>{const t=this._userState===d.anonymous;this._userState=d.authenticated,e.token!==this._currentToken&&(this._currentToken=e.token,this._tokenListeners.forEach((t=>t(e.token))),this._scheduleTokenRefresh(e.expire?.getTime?.()-18e4-Date.now())),t&&(this._profilePromise=void 0,this.getProfile().then((()=>this._profileListeners.forEach((e=>e()))))),this._imsDeferred?.isSettled||this._imsDeferred?.resolve()},this._onReady=async()=>{(0,a.tz)(),this.isSignedInUser()||await this._onAccessTokenHasExpired(),this.allowLoggedOutUser||await this.ensureSignedInUser()},this._onAccessTokenHasExpired=async()=>{this._userState!==d.uninitialized&&this._userState!==d.authenticated||(this._userState=this._userState===d.uninitialized?d.anonymous:d.expired,this._userState===d.anonymous&&this.allowLoggedOutUser&&this._makeAnonymousProfile(),this._userState!==d.expired&&this.allowLoggedOutUser||await this._signInInternal("access token expired",{},!0),this._imsDeferred?.isSettled||this._imsDeferred?.resolve())},this._onError=(e,t)=>{throw this._imsDeferred?.reject(t),new r.R("ImsError",e,new Error(t))},this._generateAnonymousUserId=()=>`${(0,o.Z)()}@anonymous`,this._persistAnonymousProfile=(e,t)=>{this._sessionStorageService.setInStorage(h,JSON.stringify({userId:e,name:t}))},this._retrieveAnonymousProfile=()=>{try{return JSON.parse(this._sessionStorageService.getFromStorage(h)??"")}catch(e){return}},this._makeAnonymousProfile=()=>{const e=this._retrieveAnonymousProfile(),{userId:t,name:i}=e??{userId:this._generateAnonymousUserId(),name:"Guest"};e||this._persistAnonymousProfile(t,i),this._profilePromise=Promise.resolve({account_type:"anonymous",countryCode:"UD",displayName:i,email:"",emailVerified:"false",first_name:i,last_name:"",mrktPerm:"",mrktPermEmail:"false",name:i,phoneNumber:"",preferred_languages:null,userId:t,utcOffset:""})},this._overrideErrorHandlerFunction=e=>{const t=new URL(window.location.href);return t.searchParams.set("redirectError",JSON.stringify(e)),window.history.replaceState(null,"",t),this._logger?.debug(`Check token error in embed context. Error: ${JSON.stringify(e)}`),!1},this._perf.beginStartupAction(l.imsLoad);const{allowLoggedOutUser:m,customSignInEnabled:S}=_;this.allowLoggedOutUser=Boolean(m),this.customSignInEnabled=Boolean(S),this._adobeIMS=new s.H(this.adobeIdData),window.adobeIMS=this._adobeIMS,window.adobeid=this._adobeIMS.adobeid;const{customSignInCallback:I}=this._imsServiceOptions;I&&this.registerCustomSignInCallback(I)}get locale(){return this._locale}set locale(e){this._locale=e}get adobeIMS(){return this._adobeIMS}get adobeIdData(){const e={client_id:this._imsServiceOptions.clientId,environment:this._imsServiceOptions.environment,scope:this._imsServiceOptions.scope,useLocalStorage:!1,autoValidateToken:!0,modalMode:this.isLoadedInIFrame(),modalSettings:{allowedOrigin:location.protocol+"//"+location.host},onReady:this._onReady,onError:this._onError,onAccessToken:this._onAccessToken,onAccessTokenHasExpired:this._onAccessTokenHasExpired};return this._addEmbedSpecificParams(e),e}get isLoaded(){return!0===this._imsDeferred?.isSettled}registerCustomSignInCallback(e){this.customSignInEnabled&&(this._customSignInCallback=e)}async load(){return this._imsDeferred||(this._imsDeferred=new n.B,this._imsDeferred.promise.then((()=>this._perf.endStartupAction(l.imsLoad))),await this.adobeIMS.initialize(),this.registerServiceWorkerMessage()),this._imsDeferred.promise}registerServiceWorkerMessage(){try{if(!("serviceWorker"in this._navigator))return;this._navigator.serviceWorker.removeEventListener("message",this.processServiceWorkerMessage),this._navigator.serviceWorker.addEventListener("message",this.processServiceWorkerMessage)}catch(e){this._logger.error(`Failed to add service worker message event listener ${e}`)}}isSignedInUser(){return this.adobeIMS.isSignedInUser()}isAnonymousUser(){return this._userState===d.anonymous}async getProfile(){return this.allowLoggedOutUser?await this.load():await this.ensureSignedInUser(),this._profilePromise||(this._profilePromise=this.adobeIMS.getProfile()),this._profilePromise}async getAccessTokenValue(){return this.isLoaded||await this.load(),this.adobeIMS.getAccessToken()?.token}addTokenListener(e){this._tokenListeners.add(e)}removeTokenListener(e){this._tokenListeners.delete(e)}addProfileListener(e){this._profileListeners.add(e)}removeProfileListener(e){this._profileListeners.delete(e)}async updateAnonymousProfile(e){const{userId:t}=this._retrieveAnonymousProfile();this._persistAnonymousProfile(t??this._generateAnonymousUserId(),e),this._makeAnonymousProfile(),this._profileListeners.forEach((e=>e()))}async ensureSignedInUser(e=!1){this.isLoaded||await this.load(),this.allowLoggedOutUser&&!e||this.isSignedInUser()||await this._signInInternal("user not signed in",{},!0)}async _signInCustom(e,t){if(!this.customSignInEnabled||!this._customSignInCallback)return this._signIn(e,t);if(this._customSignInDeferred)return this._customSignInDeferred.promise;this._customSignInDeferred=new n.B,this._logger.debug(`Will redirect to custom sign in screen. Reason: ${e}`),this._makeAnonymousProfile(),this._userState=d.anonymous,this._imsDeferred?.isSettled||this._imsDeferred?.resolve();try{await this._customSignInCallback(t),this._customSignInDeferred?.resolve(),this._customSignInDeferred=void 0}catch(i){return this._logger.debug(`Couldn't invoke custom sign in flow, falling back to IMS sign in: ${i}`),this._signIn(e,t)}}async _signInInternal(e,t,i=!1){if(this.customSignInEnabled&&i)return this._signInCustom(e,t);await this._signIn(e,t)}async _signIn(e,t){return this._logger?.debug(`Will redirect to IMS login. Reason: ${e}`),new Promise((()=>{this.adobeIMS.signIn({...t,locale:t?.locale||this._locale})}))}async _signUp(e,t){return this._logger?.debug(`Will redirect to IMS Sign Up. Reason: ${e}`),new Promise((()=>{this.adobeIMS.signUp({...t,locale:t?.locale||this._locale})}))}_inIframeSignIn(e,t){return this._logger?.debug(`Will launch pop window of IMS login. Reason: ${e}`),this._modalSignInOptions=t,this._modalSUSICallbackAttached||window.addEventListener("message",this._modalSUSICallbackFunc),this.adobeIMS.signIn({...t,locale:t?.locale||this._locale}),this._modalSignInDeferred.promise}_inIframeSignUp(e,t){return this._logger?.debug(`Will launch pop window of IMS SignUp. Reason: ${e}`),this._modalSignInOptions=t,this._modalSUSICallbackAttached||window.addEventListener("message",this._modalSUSICallbackFunc),this.adobeIMS.signUp({...t,locale:t?.locale||this._locale}),this._modalSignInDeferred.promise}_reload(e){window.location.assign(e)}signOut(e){this.adobeIMS.signOut(e)}getRedirectUrl(e){const t=e?new URL(e):new URL(window.location.href);return(0,a.F0)(this._sessionPersistenceService.getOtpToken(),t)}async _signInWithSocialProvider(e,t){return new Promise((()=>{this.adobeIMS.signInWithSocialProvider(e,{...t,locale:t?.locale||this._locale})}))}async signInWithSocialProvider(e,t){const i={redirect_uri:this.getRedirectUrl(t).href};await this._signInWithSocialProvider(e,i)}async customSignIn(e){await this.signIn(e,!0)}async signIn(e,t=!1,i={}){const s=this.getRedirectUrl(e),r="Manual trigger",n={...i,redirect_uri:s.href};if(this.isLoadedInIFrame())return s.searchParams.set("_cb",`${Date.now()}`),n.redirect_uri=s.href,void await this._inIframeSignIn(r,n);await this._signInInternal(r,n,t)}async signUp(e){const t=this.getRedirectUrl(e),i="Manual trigger",s={redirect_uri:t.href};if(this.isLoadedInIFrame())return t.searchParams.set("_cb",`${Date.now()}`),s.redirect_uri=t.href,void await this._inIframeSignUp(i,s);await this._signUp(i,s)}_getTopWindow(){return window.top}_getCurrentWindow(){return window.self}isLoadedInIFrame(){return this._getTopWindow()!==this._getCurrentWindow()}async refreshToken(){return this._refreshTokenPromise||(this._refreshTokenPromise=new Promise((async e=>{try{this._logger.info("refreshToken is starting"),await this.adobeIMS.refreshToken(),e("noError")}catch(t){"rate_limited"===t.error?(this._logger.warn(`refreshToken failed. The server requested a retry after ${t.retryAfter} seconds"`),e(Number(t.retryAfter))):(this._logger.warn(`refreshToken failed with error "${t.error}"`),e(String(t.error)))}this._refreshTokenPromise=void 0}))),this._refreshTokenPromise}_scheduleTokenRefresh(e){!e||e<0||(clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout((()=>this.refreshToken()),e))}_addEmbedSpecificParams(e){const t=new URLSearchParams(window.location.search);t.get("embed")&&(t.get("userId")&&(e.api_parameters={...e.api_parameters,check_token:{user_id:t.get("userId")}}),e.analytics={appCode:"embed_"+t.get("ccEverywhereHostClientId")},e.redirect_uri=this.getRedirectUrl().toString(),e.overrideErrorHandler=this._overrideErrorHandlerFunction)}}},632353:(e,t,i)=>{i.d(t,{F0:()=>a,Uz:()=>h,tz:()=>o});const s="hz_persistence",r="otp",n=/&?otp=(\d+)/,o=()=>{const e=window.location.hash.replace(n,"");""===e?window.history.replaceState(null,"",window.location.pathname+window.location.search):window.location.hash=e},a=(e,t)=>{const i=t.hash?"&":"";return t.hash+=`${i}otp=${e}`,t};class h{constructor(e){this._storedData={},this._sessionStorageService=e,this._restoredData=this._restoreData(),this.persist(r,Math.random().toFixed(10).substring(3))}getOtpToken(){return this._storedData[r]}getRestoredData(e){return this._restoredData[e]}persist(e,t){this._storedData[e]=t,this._sessionStorageService.setInStorage(s,JSON.stringify(this._storedData))}remove(e){delete this._restoredData[e],delete this._storedData[e],this._sessionStorageService.setInStorage(s,JSON.stringify(this._storedData))}_restoreData(){const e=this._getPersistedData();return e[r]!==(window.location.hash.match(n)?.[1]||"")?[]:e}_getPersistedData(){try{return JSON.parse(this._sessionStorageService.getFromStorage(s)??"{}")}catch(e){return{}}}}}}]);
//# sourceMappingURL=30822.b058e9bffdb73836ee40.js.map